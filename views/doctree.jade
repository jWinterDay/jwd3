

extends layout

block content
    p(id="totalUsers")

    section
        hgroup
            h1 Docs tree
        fieldset
            legend Docs tree

            div(id="doctreeContainer")
                table(id="docTree")
                    thead
                        tr
                            th Имя
                            th Ссылка
                            th Дата загрузки
                            th Добавил
                            th Дом. страница
                    tbody
                        - for (var x=0; x<docs.length; x++ ) {
                        - var item = docs[x];
                            tr(data-tt-id="#{item._id}", data-tt-parent-id="#{item.parent}", 
                                data-originalname="#{item.originalFileName}", data-is-folder="#{item.isFolder}",
                                data-fileName="#{item.fileName}")

                                td 
                                    -if (item.isFolder === true) {
                                    span(class="folder")
                                    -} else {
                                    span(class="file") 
                                    -}
                                    != item.name

                                td
                                    -if (item.fileName == undefined) {
                                    a(style="color: #b03b0f") #{item.fileName}
                                    -} else {
                                    a(href="#{item.fileName}", style="color: #b03b0f") #{item.fileName}
                                    -}

                                td 
                                    p #{item.createDate}

                                td
                                    -if(item && ('user' in item) && ('email' in item.user)) {
                                    p(class="text-danger") #{item.user['email']}
                                    -} else {
                                    p
                                    -}

                                td
                                    -if(docs[x].isHome === undefined || docs[x].isHome === false) {
                                    input(type="checkbox", disabled="disabled")
                                    -} else {
                                    input(type="checkbox", disabled="disabled", checked="checked")
                                    -}
                        - }


            form(id="uploadForm", enctype="multipart/form-data", action="/api/protected/journal/upload", method="post")
                div(hidden)
                    input(type="file", name="doc", id="hiddenSelectFile", accept=".pdf")
                    input(type="submit", name="submit", value="upload doc")
                    input(id="parentId", type="text", name="parentId")
                
                div
                    -if ( roles && roles.indexOf("admin") !== -1 ) {
                        input(id="addFolderDoc", type="button", class="btn btn-primary has-margin", value="Добавить папку")
                        input(id="addDoc", type="button", class="btn btn-primary has-margin", value="Добавить файл")
                        input(id="delDoc", type="button", class="btn btn-danger has-margin", value="Удалить файл")
                    - }
                    input(id="downloadDoc", type="button", class="btn btn-success has-margin", value="Скачать")
                span(id = "status")


    input(id="csrftoken", type="hidden", value="#{csrftoken}")

    //section(id="docTreeSection")
    //    hgroup
    //        h1 doc tree
            
    //    fieldset
    //        legend doc tree
    div(id="pdfDiv")        
        div(id="pdfPage", style="position: fixed")
        div(id="docContainer", class="pdf-content")
            canvas(id="pdfCanvas")
            div(id="ldiv")

    link(href="/libs/jquery-treetable/css/jquery.treetable.css", rel="stylesheet", type="text/css")
    link(href="/libs/jquery-treetable/css/jquery.treetable.theme.default.css", rel="stylesheet", type="text/css")
    link(rel="stylesheet", href="libs/simplePagination/simplePagination.css")
    link(rel="stylesheet", href="/libs/sweetalert/dist/sweetalert.css")

    //link(rel="stylesheet", href="/libs/bootstrap-3.3.7-dist/css/bootstrap.css")

    script(src="/libs/jquery-cookie-1.4.1/jquery.cookie.js")
    script(src="/libs/jquery.form/jquery.form.js")
    script(src="/libs/jqGrid/js/i18n/grid.locale-en.js")
    script(src="/libs/jquery-treetable/jquery.treetable.js")
    script(src="/libs/pdfjs/pdfjs-ui-utils.js")
    script(src="/libs/simplePagination/jquery.simplePagination.js ")
    script(src="/libs/sweetalert/dist/sweetalert.min.js")
    script(src="/libs/filedownload/filedownload.js")

    script(src="/libs/underscore/underscore.js")
    script(src="/socket.io/socket.io.js")


    script(src="/libs/pdfjs/pdf.js")
    script(src="/libs/pdfjs-dist/web/compatibility.js")
    script(src="/libs/pdfjs-dist/build/pdf.combined.js")
    script(src="/libs/pdfjs-dist/web/pdf_viewer.js")

    script(src="/scripts/doctree.js")


    